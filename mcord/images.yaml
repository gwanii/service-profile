tosca_definitions_version: tosca_simple_yaml_1_0

imports:
   - custom_types/xos.yaml

description: openstack extensions to deployment, generated by platform-install

topology_template:
 node_templates:

# Images and flavors
    trusty-server-multi-nic:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/trusty-server-multi-nic.qcow2
         disk_format: QCOW2
         container_format: BARE

    bbu-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/bbu-snapshot-Feb20.ami
         disk_format: ami
         container_format: ami
    bbu_kernel:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/bbu_kernel.aki
         disk_format: aki
         container_format: aki

    open-mme-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/open-mme-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    open-sgw-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/open-sgw-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    open-pgw-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/open-pgw-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE

    licenseserver-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/licenseserver-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    hss-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/hss-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE

    mme1-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/mme1-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    sgwc1-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/sgwc1-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    pgwc1-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/pgwc1-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    sgwu1-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/sgwu1-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    pgwu1-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/pgwu1-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE

    mme2-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/mme2-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    sgwc2-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/sgwc2-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    pgwc2-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/pgwc2-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    sgwu2-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/sgwu2-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    pgwu2-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/pgwu2-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE

    cookie-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/cookie-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    NAT-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/NAT-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE
    xpose-snapshot-Feb20:
      type: tosca.nodes.Image
      properties:
         path: /opt/xos/images/xpose-snapshot-Feb20.qcow2
         disk_format: QCOW2
         container_format: BARE

#    licenseserver:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/licenseserver.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    hss:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/hss.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    mme:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/mme.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    pgwc:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/pgwc.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    pgwu:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/pgwu.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    sgwc:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/sgwc.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    sgwu:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/sgwu.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    bbu:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/bbu.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    bbu_s:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/bbus.qcow2
#         disk_format: QCOW2
#         container_format: BARE
#    cookies:
#      type: tosca.nodes.Image
#      properties:
#         path: /opt/xos/images/cookies.qcow2
#         disk_format: QCOW2
#         container_format: BARE


    m1.small:
      type: tosca.nodes.Flavor

    m1.medium:
      type: tosca.nodes.Flavor

    m1.large:
      type: tosca.nodes.Flavor

    m1.xlarge:
      type: tosca.nodes.Flavor


# Deployment - adds images/flavors to site defined in deployment.yaml
    MyDeployment:
      type: tosca.nodes.Deployment
      requirements:
          - m1.small:
              node: m1.small
              relationship: tosca.relationships.SupportsFlavor
          - m1.medium:
              node: m1.medium
              relationship: tosca.relationships.SupportsFlavor
          - m1.large:
              node: m1.large
              relationship: tosca.relationships.SupportsFlavor
          - m1.xlarge:
              node: m1.xlarge
              relationship: tosca.relationships.SupportsFlavor

# OpenStack Controller
    mysite_MyDeployment_openstack:
      type: tosca.nodes.Controller
      requirements:
        - deployment:
            node: MyDeployment
            relationship: tosca.relationships.ControllerDeployment
      properties:
          backend_type: OpenStack
          version: Kilo
          auth_url: { get_script_env: [ SELF, adminrc, OS_AUTH_URL, LOCAL_FILE] }
          admin_user: { get_script_env: [ SELF, adminrc, OS_USERNAME, LOCAL_FILE] }
          admin_password: { get_script_env: [ SELF, adminrc, OS_PASSWORD, LOCAL_FILE] }
          admin_tenant: { get_script_env: [ SELF, adminrc, OS_TENANT_NAME, LOCAL_FILE] }
          domain: Default
      artifacts:
          adminrc: /root/setup/admin-openrc.sh

# Site - adds openstack controller to site defined in deployment.yaml
    mysite:
      type: tosca.nodes.Site
      properties:
          display_name: MySite
          site_url: http://mysite.opencloud.us/
          hosts_nodes: true
      requirements:
        - deployment:
            node: MyDeployment
            relationship: tosca.relationships.MemberOfDeployment
        - controller:
            node: mysite_MyDeployment_openstack
            relationship: tosca.relationships.UsesController

